{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/marci/source/repos/jgmarry.me/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _slicedToArray from\"C:/Users/marci/source/repos/jgmarry.me/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"C:/Users/marci/source/repos/jgmarry.me/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React,{useState}from\"react\";import{StatusCodes}from'http-status-codes';import\"../styles/login.css\";import Signup from\"../components/signup\";import{ToastContainer,toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function loginFamily(_x){return _loginFamily.apply(this,arguments);}function _loginFamily(){_loginFamily=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(password){var requestOptions,BACKEND_URL,result;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:requestOptions={method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({\"password\":password})};BACKEND_URL=\"https://us-central1-wedding-41b3e.cloudfunctions.net\";_context2.next=4;return fetch(\"\".concat(BACKEND_URL,\"/login\"),requestOptions).then(function(response){return response;}).catch(function(_){result.status=StatusCodes.SERVICE_UNAVAILABLE;return result;});case 4:result=_context2.sent;if(!(result.status===StatusCodes.OK)){_context2.next=9;break;}return _context2.abrupt(\"return\",result.json());case 9:console.log(\"\\n ======= While logging backend respond with status: \".concat(result.status,\" ======= \\n\"));return _context2.abrupt(\"return\",result.status);case 11:case\"end\":return _context2.stop();}},_callee2);}));return _loginFamily.apply(this,arguments);}function isClientOrServerError(statusCode){var statusCodeString=statusCode.toString();var firstChar=statusCodeString.charAt(0);return firstChar==='4'||firstChar==='5';}export default function Rsvp(){var PASSWORD_LENGTH=6;var sanitizer=require(\"string-sanitizer\");var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isDisabled=_useState2[0],setIsDisabled=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoggedIn=_useState6[0],setIsLoggedIn=_useState6[1];var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),family=_useState8[0],setFamily=_useState8[1];var notify=function notify(){return toast(\"Dziękujemy za wysłanie potwierdzenia!\");};function handleFamilyUpdate(){setIsLoggedIn(false);notify();}function handleSubmit(_x2){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var password,sanitized_password,family;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:event.preventDefault();setIsDisabled(true);password=document.getElementById(\"loginPassword\").value;if(!(password.length!==PASSWORD_LENGTH)){_context.next=7;break;}setErrorMessage(\"hasło ma dokładnie 6 znaków.\");setIsDisabled(false);return _context.abrupt(\"return\");case 7:sanitized_password=sanitizer.sanitize.keepNumber(password);_context.next=10;return loginFamily(sanitized_password);case 10:family=_context.sent;if(family===StatusCodes.NOT_FOUND){setErrorMessage(\"nie znaleziono rodziny dla podanego hasła.\");setIsDisabled(false);}if(family===StatusCodes.UNAUTHORIZED){setErrorMessage(\"nieprawidłowe hasło.\");setIsDisabled(false);}else if(isClientOrServerError(family)){// jeśli dwie rodziny mają to samo hasło - wywala\nsetErrorMessage(\"przepraszamy, wystąpił błąd serwera.\");setIsDisabled(false);}else if(family!==undefined&&\"members\"in family){setErrorMessage(\"\");setIsDisabled(false);setIsLoggedIn(true);setFamily(family);}case 13:case\"end\":return _context.stop();}},_callee);}));return _handleSubmit.apply(this,arguments);}return/*#__PURE__*/_jsxs(\"section\",{className:\"login section\",id:\"login\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",children:\"RSVP\"}),/*#__PURE__*/_jsx(\"span\",{className:\"section-subtitle\",children:\"Powiadom nas\"}),isLoggedIn?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Signup,{family:family,onFamilyUpdate:handleFamilyUpdate})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"login__container container\",children:/*#__PURE__*/_jsxs(\"form\",{className:\"login__form\",onSubmit:handleSubmit,method:\"POST\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:/*#__PURE__*/_jsx(\"p\",{className:\"login__description\",children:\"Podaj has\\u0142o z zaproszenia\"})}),/*#__PURE__*/_jsx(\"input\",{className:\"login__form-input\",type:\"password\",id:\"loginPassword\",name:\"password\",maxLength:PASSWORD_LENGTH}),!errorMessage!==\"\"?/*#__PURE__*/_jsx(\"span\",{style:{color:\"red\"},children:/*#__PURE__*/_jsx(\"div\",{className:\"login__form-error\",children:errorMessage})}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(\"input\",{className:\"button button--flex\",type:\"submit\",value:\"Zaloguj si\\u0119\",disabled:isDisabled})]})})}),/*#__PURE__*/_jsx(ToastContainer,{position:\"top-right\",autoClose:5000,hideProgressBar:false,newestOnTop:false,closeOnClick:true,rtl:false,pauseOnFocusLoss:true,draggable:true,pauseOnHover:true,theme:\"light\"})]});}","map":{"version":3,"names":["React","useState","StatusCodes","Signup","ToastContainer","toast","loginFamily","password","requestOptions","method","headers","body","JSON","stringify","BACKEND_URL","fetch","then","response","catch","_","result","status","SERVICE_UNAVAILABLE","OK","json","console","log","isClientOrServerError","statusCode","statusCodeString","toString","firstChar","charAt","Rsvp","PASSWORD_LENGTH","sanitizer","require","isDisabled","setIsDisabled","errorMessage","setErrorMessage","isLoggedIn","setIsLoggedIn","family","setFamily","notify","handleFamilyUpdate","handleSubmit","event","preventDefault","document","getElementById","value","length","sanitized_password","sanitize","keepNumber","NOT_FOUND","UNAUTHORIZED","undefined","color"],"sources":["C:/Users/marci/source/repos/jgmarry.me/src/pages/rsvp.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { StatusCodes } from 'http-status-codes';\r\nimport \"../styles/login.css\"\r\nimport Signup from \"../components/signup\";\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nasync function loginFamily(password) {\r\n\r\n    const requestOptions = {\r\n        method: \"POST\",\r\n        headers: {\r\n            \"Content-Type\": \"application/json\"\r\n        },\r\n        body: JSON.stringify({ \"password\": password })\r\n    };\r\n\r\n    const BACKEND_URL = \"https://us-central1-wedding-41b3e.cloudfunctions.net\";\r\n\r\n    let result = await fetch(`${BACKEND_URL}/login`, requestOptions)\r\n        .then(response => { return response; })\r\n        .catch(_ => {\r\n            result.status = StatusCodes.SERVICE_UNAVAILABLE;\r\n            return result; });\r\n\r\n    if (result.status === StatusCodes.OK){\r\n        return result.json();\r\n    }\r\n    else{\r\n        console.log(`\\n ======= While logging backend respond with status: ${result.status} ======= \\n`);\r\n\r\n        return result.status;\r\n    }\r\n}\r\n\r\nfunction isClientOrServerError(statusCode) {\r\n    const statusCodeString = statusCode.toString();\r\n    const firstChar = statusCodeString.charAt(0);\r\n    return firstChar === '4' || firstChar === '5';\r\n  }\r\n\r\nexport default function Rsvp() {\r\n\r\n    const PASSWORD_LENGTH = 6;\r\n    let sanitizer = require(\"string-sanitizer\");\r\n\r\n    const [isDisabled, setIsDisabled] = useState(false);\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n\r\n    const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n    const [family, setFamily] = useState({});\r\n\r\n    const notify = () => toast(\"Dziękujemy za wysłanie potwierdzenia!\");\r\n    \r\n    function handleFamilyUpdate() {\r\n        setIsLoggedIn(false);\r\n        notify();\r\n      }\r\n\r\n    async function handleSubmit(event) {\r\n        event.preventDefault();\r\n\r\n        setIsDisabled(true);\r\n        var password = document.getElementById(\"loginPassword\").value;\r\n\r\n        if (password.length !== PASSWORD_LENGTH) {\r\n            setErrorMessage(\"hasło ma dokładnie 6 znaków.\");\r\n            setIsDisabled(false);\r\n            return;\r\n        }\r\n\r\n        let sanitized_password = sanitizer.sanitize.keepNumber(password);\r\n        let family = await loginFamily(sanitized_password);\r\n\r\n        if (family === StatusCodes.NOT_FOUND) {\r\n            setErrorMessage(\"nie znaleziono rodziny dla podanego hasła.\");\r\n            setIsDisabled(false);\r\n        }\r\n        if (family === StatusCodes.UNAUTHORIZED) {\r\n            setErrorMessage(\"nieprawidłowe hasło.\");\r\n            setIsDisabled(false);\r\n        }\r\n        else if (isClientOrServerError(family)) {\r\n            // jeśli dwie rodziny mają to samo hasło - wywala\r\n            setErrorMessage(\"przepraszamy, wystąpił błąd serwera.\");\r\n            setIsDisabled(false);\r\n        }\r\n        else if (family !== undefined && \"members\" in family) {\r\n            setErrorMessage(\"\");\r\n            setIsDisabled(false);\r\n\r\n            setIsLoggedIn(true);\r\n            setFamily(family);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <section className=\"login section\" id=\"login\">\r\n            <h2 className=\"section-title\">RSVP</h2>\r\n            <span className=\"section-subtitle\">Powiadom nas</span>\r\n            {isLoggedIn ? \r\n            <>\r\n                <Signup\r\n                    family={family}\r\n                    onFamilyUpdate={handleFamilyUpdate}\r\n                />\r\n            </>\r\n            : \r\n            <>\r\n                <div className=\"login__container container\">\r\n                    <form className=\"login__form\" onSubmit={handleSubmit} method=\"POST\">\r\n                        <label htmlFor=\"password\"><p className=\"login__description\">Podaj hasło z zaproszenia</p></label>\r\n                        <input className=\"login__form-input\" type={\"password\"} id=\"loginPassword\" name=\"password\" maxLength={PASSWORD_LENGTH}></input>\r\n                        {(!errorMessage !== \"\") ? <span style={{ color: \"red\" }} ><div className=\"login__form-error\">{errorMessage}</div></span> : <></>}\r\n                        <input className=\"button button--flex\" type=\"submit\" value=\"Zaloguj się\" disabled={isDisabled}></input>\r\n                    </form>\r\n                </div>\r\n            </>}\r\n            <ToastContainer\r\n                position=\"top-right\"\r\n                autoClose={5000}\r\n                hideProgressBar={false}\r\n                newestOnTop={false}\r\n                closeOnClick\r\n                rtl={false}\r\n                pauseOnFocusLoss\r\n                draggable\r\n                pauseOnHover\r\n                theme=\"light\"\r\n            />\r\n            \r\n        </section>\r\n    )\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}